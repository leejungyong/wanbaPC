(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-400a6997"],{"05c9":function(t,e,n){},1412:function(t,e,n){"use strict";var o=n("05c9"),a=n.n(o);a.a},"3c43":function(t,e){e.endianness=function(){return"LE"},e.hostname=function(){return"undefined"!==typeof location?location.hostname:""},e.loadavg=function(){return[]},e.uptime=function(){return 0},e.freemem=function(){return Number.MAX_VALUE},e.totalmem=function(){return Number.MAX_VALUE},e.cpus=function(){return[]},e.type=function(){return"Browser"},e.release=function(){return"undefined"!==typeof navigator?navigator.appVersion:""},e.networkInterfaces=e.getNetworkInterfaces=function(){return{}},e.arch=function(){return"javascript"},e.platform=function(){return"browser"},e.tmpdir=e.tmpDir=function(){return"/tmp"},e.EOL="\n",e.homedir=function(){return"/"}},"3e8f":function(t,e){},"3f49":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"activity-list"},[n("div",{staticClass:"refresh"},[n("Button",{on:{click:t.refreshList}},[t._v("刷新数据")]),n("Button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary"},on:{click:t.toNewAct}},[t._v("新建活动")]),n("span",{staticClass:"downloadExcel clearfix"},[n("Button",{attrs:{type:"info",ghost:"",to:"http://img.wondfun.com/wanba/api/download/wanba_act_template.xlsx",target:"_blank"}},[t._v("活动模板下载")])],1)],1),n("Table",{attrs:{columns:t.tableTitle,data:t.tableData,loading:t.tableLoading}}),n("Modal",{attrs:{title:"导入excel"},on:{"on-ok":t.ok,"on-cancel":t.cancel},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[n("Row",[n("Upload",{attrs:{action:"","before-upload":t.handleBeforeUpload,accept:".xls, .xlsx"}},[n("Button",{attrs:{icon:"ios-cloud-upload-outline",loading:t.uploadLoading},on:{click:t.handleUploadFile}},[t._v("上传文件")])],1)],1),n("Row",[null!==t.file?n("div",{staticClass:"ivu-upload-list-file"},[n("Icon",{attrs:{type:"ios-stats"}}),t._v("\n          "+t._s(t.file.name)+"\n        "),n("Icon",{directives:[{name:"show",rawName:"v-show",value:t.showRemoveFile,expression:"showRemoveFile"}],staticClass:"ivu-upload-list-remove",attrs:{type:"ios-close"},nativeOn:{click:function(e){return t.handleRemove()}}})],1):t._e()]),n("Row",[n("transition",{attrs:{name:"fade"}},[t.showProgress?n("Progress",{attrs:{percent:t.progressPercent,"stroke-width":2}},[100==t.progressPercent?n("div",[n("Icon",{attrs:{type:"ios-checkmark-circle"}}),n("span",[t._v("成功")])],1):t._e()]):t._e()],1)],1)],1)],1)},a=[],i=(n("7f7f"),n("28a5"),n("cebc")),r=n("bc3a"),s=n.n(r),l=n("a78e"),c=n.n(l),d=n("0a21"),u=(n("3c43"),n("3e8f"),n("2f62")),p=n("69d9"),f={name:"activity-list",data:function(){var t=this;return{modal:!1,modal2:!1,uploadLoading:!1,progressPercent:0,showProgress:!1,showRemoveFile:!1,file:null,tableTitle2:[],tableData2:[],tableLoading:!1,tableTitle:[{key:"date",title:"时间"},{key:"title",title:"活动名称"},{key:"sharepic",title:"图片"},{key:"action",title:"操作",render:function(e,n){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.modal=!0,t.aid=n.row.aid}}},"导入"),e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){s.a.post(p["serverUrl"]+"/api/pcindex.php?act=getTaskList",{aid:n.row.aid,openid:t.uid}).then(function(e){e&&(console.log(e),e.data.length>0?(t.$router.push({name:"活动编辑"}),t.setAObj(n.row),t.setOpenid(t.uid)):0==e.data.length&&t.$Modal.error({title:"提示",content:"请先导入活动！"}))})}}},"编辑")])}}],tableData:[],uid:"",aid:"",type:["0-人工判定","1-自动精确匹配","2-自动模糊匹配","3-答案包含在回答里","4-回答包含在答案里","5-教练提交管理员判定","6-N里多选","7-教练评分"]}},created:function(){this.getList()},computed:{tagNavList:function(){return this.$store.state.app.tagNavList}},methods:Object(i["a"])({},Object(u["d"])(["setAObj","setOpenid"]),{toNewAct:function(){this.$router.push({name:"新建活动"})},refreshList:function(){this.getList(),console.log(this.$store.state.user.avatarImgPath)},getList:function(){var t=this;this.tableLoading=!0,this.uid=c.a.get("uid"),s.a.post(p["serverUrl"]+"/api/pcindex.php?act=pcMyActData",{openid:this.uid}).then(function(e){e&&(t.tableData=e.data.actNow,t.tableLoading=!1)})},initUpload:function(){this.file=null,this.showProgress=!1,this.loadingProgress=0,this.tableData2=[],this.tableTitle2=[]},handleUploadFile:function(){this.initUpload()},handleRemove:function(){this.initUpload(),this.$Message.info("上传的文件已删除！")},handleBeforeUpload:function(t){var e=t.name.split(".").pop().toLocaleLowerCase();return"xlsx"===e||"xls"===e?this.readFile(t):this.$Notice.warning({title:"文件类型错误",desc:"文件："+t.name+"不是EXCEL文件，请选择后缀为.xlsx或者.xls的EXCEL文件。"}),!1},readFile:function(t){var e=this,n=new FileReader;n.readAsArrayBuffer(t),n.onloadstart=function(t){e.uploadLoading=!0},n.onprogress=function(t){e.progressPercent=Math.round(t.loaded/t.total*100)},n.onerror=function(t){e.$Message.error("文件读取出错")},n.onload=function(n){var o=n.target.result,a=d["default"].read(o,"array"),i=a.header,r=a.results,s=r.every(function(t){return void 0!=t.点位名称&&void 0!=t.任务介绍&&void 0!=t.问题类型}),l=r.every(function(t){return void 0!=t.点位名称&&void 0==t.任务介绍&&void 0==t.问题类型}),c=0,u=0;if(s||l)for(var p=/^[0-9]+(\.\d+)?[,][0-9]+(\.\d+)?$/,f=0;f<r.length;f++){if(void 0!=r[f].原始gps坐标||void 0!=r[f].腾讯地图坐标){if(r[f].原始gps坐标){var h=r[f].原始gps坐标;if(p.test(h)){var g=h.split(",");(g[0]<0||g[0]>90)&&e.$Modal.error({title:"错误",content:"点位"+r[f].序号+":纬度范围必须在0-90之间"}),(g[1]<0||g[1]>180)&&e.$Modal.error({title:"错误",content:"点位"+r[f].序号+":经度必须在0-180之间！"}),g[0]>=0&&g[0]<=90&&g[1]>=0&&g[1]<=180&&(c+=1)}else e.$Modal.error({title:"错误",content:"点位"+r[f].序号+":请输入正确的经纬度格式，例如(30,120)，注意：请用英文的逗号"})}else if(r[f].腾讯地图坐标){var v=r[f].腾讯地图坐标;if(p.test(v)){var m=v.split(",");(m[0]<0||m[0]>90)&&e.$Modal.error({title:"错误",content:"点位"+r[f].序号+":纬度范围必须在0-90之间"}),(m[1]<0||m[1]>180)&&e.$Modal.error({title:"错误",content:"点位"+r[f].序号+":经度必须在0-180之间！"}),m[0]>=0&&m[0]<=90&&m[1]>=0&&m[1]<=180&&(c+=1)}else e.$Modal.error({title:"错误",content:"点位"+r[f].序号+":请输入正确的经纬度格式，例如(30,120)，注意：请用英文的逗号"})}}else e.$Modal.error({title:"错误",content:"点位"+r[f].序号+":请至少填写'原始gps坐标'或'腾讯地图坐标'的一种"});var b=r[f].问题类型;if(!l)if(25!=r[f].序号)if(-1!=e.type.indexOf(b))if(2==b.substring(0,1)||6==b.substring(0,1)){var w=r[f].答案;void 0!=w?-1==w.indexOf("|")&&(e.$Modal.error({title:"错误",content:"点位"+r[f].序号+":问题类型为2或6时，答案必须包含'|'"}),u++):void 0==w&&(e.$Modal.error({title:"错误",content:"点位"+r[f].序号+":问题类型为2或6时，答案不能为空"}),u++)}else 1!=b.substring(0,1)&&3!=b.substring(0,1)&&4!=b.substring(0,1)||void 0==r[f].答案&&(e.$Modal.error({title:"错误",content:"点位"+r[f].序号+":答案填入错误，不能为空"}),u++);else e.$Modal.error({title:"错误",content:"点位"+r[f].序号+":问题类型填写错误"}),u++;else 25==r[f].序号&&(r[f].问题类型=e.type[5],r[f].答案="")}else e.$Modal.error({title:"错误",content:"请填写完整表格数据！"});if(c==r.length&&0==u){e.file=t,e.showProgress=!0;var y=i.map(function(t){return{title:t,key:t}});e.tableData2=r,e.tableTitle2=y,e.uploadLoading=!1,e.showRemoveFile=!0,e.$Message.info("文件读取成功")}else e.file=null,e.uploadLoading=!1,e.showRemoveFile=!0,e.$Message.info("文件上传失败")}},ok:function(){var t=this;this.modal=!1,s.a.post(p["serverUrl"]+"/api/pcindex.php?act=batchImportPos",{aid:this.aid,list:this.tableData2}).then(function(e){e.data.status&&(console.log(e.data),t.file=null,t.showProgress=!1,t.loadingProgress=0,t.tableTitle2=e.data.tasklist)})},cancel:function(){this.modal=!1,this.initUpload()}})},h=f,g=(n("1412"),n("2877")),v=Object(g["a"])(h,o,a,!1,null,null,null);e["default"]=v.exports}}]);